<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Interactive Investment Dashboard</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
		rel="stylesheet">
	<style>
		:root {
			/* Professional Color Palette */
			--primary-blue: #2563eb;
			--primary-blue-dark: #1d4ed8;
			--primary-blue-light: #3b82f6;
			--secondary-gray: #64748b;
			--accent-green: #059669;
			--accent-red: #dc2626;
			--accent-yellow: #d97706;
			--accent-purple: #7c3aed;

			/* Neutral Grays */
			--gray-50: #f8fafc;
			--gray-100: #f1f5f9;
			--gray-200: #e2e8f0;
			--gray-300: #cbd5e1;
			--gray-400: #94a3b8;
			--gray-500: #64748b;
			--gray-600: #475569;
			--gray-700: #334155;
			--gray-800: #1e293b;
			--gray-900: #0f172a;

			/* Gradients */
			--primary-gradient: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-dark) 100%);
			--secondary-gradient: linear-gradient(135deg, var(--secondary-gray) 0%, var(--gray-600) 100%);
			--success-gradient: linear-gradient(135deg, var(--accent-green) 0%, #047857 100%);
			--warning-gradient: linear-gradient(135deg, var(--accent-yellow) 0%, #b45309 100%);
			--danger-gradient: linear-gradient(135deg, var(--accent-red) 0%, #b91c1c 100%);
			--elegant-gradient: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);

			/* Glass Effects */
			--glass-bg: rgba(255, 255, 255, 0.08);
			--glass-border: rgba(255, 255, 255, 0.12);
			--glass-bg-dark: rgba(15, 23, 42, 0.8);
			--glass-border-dark: rgba(255, 255, 255, 0.1);

			/* Shadows */
			--subtle-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
			--medium-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
			--deep-shadow: 0 10px 15px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
			--xl-shadow: 0 20px 25px rgba(0, 0, 0, 0.1), 0 10px 10px rgba(0, 0, 0, 0.04);

			/* Typography */
			--font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			--font-size-xs: 0.75rem;
			--font-size-sm: 0.875rem;
			--font-size-base: 1rem;
			--font-size-lg: 1.125rem;
			--font-size-xl: 1.25rem;
			--font-size-2xl: 1.5rem;
			--font-size-3xl: 1.875rem;
			--font-size-4xl: 2.25rem;

			/* Spacing */
			--spacing-1: 0.25rem;
			--spacing-2: 0.5rem;
			--spacing-3: 0.75rem;
			--spacing-4: 1rem;
			--spacing-6: 1.5rem;
			--spacing-8: 2rem;
			--spacing-12: 3rem;
			--spacing-16: 4rem;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: var(--font-family);
			background: var(--elegant-gradient);
			min-height: 100vh;
			color: var(--gray-900);
			overflow-x: hidden;
			position: relative;
			font-size: var(--font-size-base);
			line-height: 1.6;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
		}

		body::before {
			content: '';
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background:
				radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
				radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
				radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
			pointer-events: none;
			z-index: -1;
		}

		.glass-card {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border: 1px solid var(--glass-border);
			border-radius: 16px;
			box-shadow: var(--medium-shadow);
			position: relative;
			overflow: hidden;
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		}

		.glass-card::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 2px;
			background: var(--primary-gradient);
			transform: scaleX(0);
			transition: transform 0.3s ease;
		}

		.glass-card:hover {
			box-shadow: var(--deep-shadow);
			transform: translateY(-2px);
		}

		.glass-card:hover::before {
			transform: scaleX(1);
		}

		.glass-card-hover {
			transition: all 0.3s ease;
		}

		.glass-card-hover:hover {
			transform: translateY(-5px);
			box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
		}

		.gradient-text {
			background: var(--primary-gradient);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		.btn-primary {
			background: var(--primary-gradient);
			border: none;
			color: white;
			padding: 12px 24px;
			border-radius: 8px;
			font-weight: 600;
			font-size: var(--font-size-sm);
			cursor: pointer;
			transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
			box-shadow: var(--medium-shadow);
			position: relative;
			overflow: hidden;
			font-family: var(--font-family);
		}

		.btn-primary::before {
			content: '';
			position: absolute;
			top: 0;
			left: -100%;
			width: 100%;
			height: 100%;
			background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
			transition: left 0.5s ease;
		}

		.btn-primary:hover {
			transform: translateY(-1px);
			box-shadow: var(--deep-shadow);
		}

		.btn-primary:hover::before {
			left: 100%;
		}

		.btn-primary:active {
			transform: translateY(0);
		}

		.btn-secondary {
			background: white;
			border: 2px solid var(--gray-200);
			color: var(--gray-700);
			padding: 12px 24px;
			border-radius: 8px;
			font-weight: 600;
			font-size: var(--font-size-sm);
			cursor: pointer;
			transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
			position: relative;
			overflow: hidden;
			font-family: var(--font-family);
		}

		.btn-secondary::before {
			content: '';
			position: absolute;
			top: 0;
			left: -100%;
			width: 100%;
			height: 100%;
			background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.05), transparent);
			transition: left 0.5s ease;
		}

		.btn-secondary:hover {
			background: var(--gray-50);
			border-color: var(--gray-300);
			color: var(--gray-900);
			transform: translateY(-1px);
			box-shadow: var(--medium-shadow);
		}

		.btn-secondary:hover::before {
			left: 100%;
		}

		.btn-secondary:active {
			transform: translateY(0);
		}

		.input-field {
			background: var(--gray-50);
			border: 2px solid var(--gray-200);
			border-radius: 8px;
			padding: 12px 16px;
			font-size: var(--font-size-base);
			transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
			width: 100%;
			color: var(--gray-900);
			font-weight: 500;
			font-family: var(--font-family);
		}

		.input-field:focus {
			outline: none;
			border-color: var(--primary-blue);
			box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
			background: white;
			transform: translateY(-1px);
		}

		.input-field:hover {
			border-color: var(--gray-300);
			background: white;
		}

		.input-field::placeholder {
			color: var(--gray-400);
		}

		.kpi-card {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 24px;
			padding: 32px 24px;
			text-align: center;
			border: 1px solid rgba(255, 255, 255, 0.2);
			box-shadow: var(--subtle-shadow);
			transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
			position: relative;
			overflow: hidden;
		}

		.kpi-card::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 2px;
			background: var(--primary-gradient);
			transform: scaleX(0);
			transition: transform 0.4s ease;
		}

		.kpi-card:hover {
			transform: translateY(-8px);
			box-shadow: var(--deep-shadow);
		}

		.kpi-card:hover::before {
			transform: scaleX(1);
		}

		.kpi-value {
			font-size: 2.5rem;
			font-weight: 800;
			margin-top: 8px;
			background: var(--primary-gradient);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		.chart-container {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 24px;
			padding: 32px;
			border: 1px solid rgba(255, 255, 255, 0.2);
			box-shadow: var(--subtle-shadow);
			height: 400px;
			position: relative;
			overflow: hidden;
		}

		.chart-container::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 1px;
			background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
		}

		.accordion {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 20px;
			margin-bottom: 20px;
			border: 2px solid rgba(255, 255, 255, 0.2);
			overflow: hidden;
			transition: all 0.3s ease;
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
		}

		.accordion:hover {
			box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
			transform: translateY(-2px);
		}

		.accordion.active {
			border-color: rgba(102, 126, 234, 0.3);
			box-shadow: 0 8px 32px rgba(102, 126, 234, 0.15);
		}

		.accordion-header {
			background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
			padding: 24px 28px;
			cursor: pointer;
			font-weight: 700;
			font-size: 18px;
			color: #667eea;
			display: flex;
			justify-content: space-between;
			align-items: center;
			transition: all 0.3s ease;
			position: relative;
		}

		.accordion-header::before {
			content: '';
			position: absolute;
			left: 0;
			top: 0;
			bottom: 0;
			width: 4px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			opacity: 0;
			transition: opacity 0.3s ease;
		}

		.accordion.active .accordion-header::before {
			opacity: 1;
		}

		.accordion-header:hover {
			background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
		}

		.accordion-content {
			padding: 28px;
			display: none;
			background: rgba(255, 255, 255, 0.5);
		}

		.accordion.active .accordion-content {
			display: block;
			animation: slideDown 0.3s ease-out;
		}

		@keyframes slideDown {
			from {
				opacity: 0;
				transform: translateY(-10px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.accordion-icon {
			transition: transform 0.3s ease;
			width: 24px;
			height: 24px;
		}

		.accordion.active .accordion-icon {
			transform: rotate(180deg);
		}

		/* Configuration section improvements */
		.config-section {
			display: grid;
			grid-template-columns: 1fr;
			gap: 20px;
		}

		@media (min-width: 1024px) {
			.config-section {
				grid-template-columns: 1fr 1fr;
			}
		}

		.config-card {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 20px;
			padding: 24px;
			border: 2px solid rgba(255, 255, 255, 0.2);
			box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
			transition: all 0.3s ease;
		}

		.config-card:hover {
			box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
			transform: translateY(-2px);
		}

		.config-card h3 {
			font-size: 20px;
			font-weight: 700;
			color: #667eea;
			margin-bottom: 20px;
			display: flex;
			align-items: center;
			gap: 12px;
		}

		.radio-group {
			display: flex;
			gap: 12px;
			flex-wrap: wrap;
		}

		.radio-option {
			background: rgba(255, 255, 255, 0.95);
			border: 2px solid rgba(102, 126, 234, 0.2);
			border-radius: 12px;
			padding: 14px 18px;
			cursor: pointer;
			transition: all 0.3s ease;
			display: flex;
			align-items: center;
			gap: 10px;
			font-weight: 500;
			color: #374151;
		}

		.radio-option:hover {
			border-color: #667eea;
			background: rgba(102, 126, 234, 0.08);
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
		}

		.radio-option input[type="radio"] {
			accent-color: #667eea;
			width: 18px;
			height: 18px;
		}

		.radio-option.selected {
			background: var(--primary-gradient);
			color: white;
			border-color: #667eea;
			box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
			transform: translateY(-1px);
		}

		.range-slider {
			width: 100%;
			height: 6px;
			border-radius: 3px;
			background: rgba(102, 126, 234, 0.2);
			outline: none;
			-webkit-appearance: none;
		}

		.range-slider::-webkit-slider-thumb {
			-webkit-appearance: none;
			appearance: none;
			width: 20px;
			height: 20px;
			border-radius: 50%;
			background: var(--primary-gradient);
			cursor: pointer;
			box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4);
		}

		.range-slider::-moz-range-thumb {
			width: 20px;
			height: 20px;
			border-radius: 50%;
			background: var(--primary-gradient);
			cursor: pointer;
			border: none;
			box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4);
		}

		.table-container {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 16px;
			padding: 24px;
			border: 1px solid var(--glass-border);
			box-shadow: var(--medium-shadow);
			overflow: hidden;
		}

		.table-container table {
			width: 100%;
			border-collapse: collapse;
			margin-top: 16px;
			font-size: var(--font-size-sm);
		}

		.table-container th,
		.table-container td {
			padding: 12px 16px;
			text-align: left;
			border-bottom: 1px solid var(--gray-200);
			transition: background-color 0.2s ease;
		}

		.table-container th {
			background: var(--gray-50);
			font-weight: 600;
			color: var(--gray-700);
			font-size: var(--font-size-xs);
			text-transform: uppercase;
			letter-spacing: 0.05em;
			cursor: pointer;
			user-select: none;
			position: relative;
		}

		.table-container th:hover {
			background: var(--gray-100);
		}

		.table-container th.sortable::after {
			content: '‚Üï';
			position: absolute;
			right: 8px;
			color: var(--gray-400);
			font-size: 12px;
		}

		.table-container th.sort-asc::after {
			content: '‚Üë';
			color: var(--primary-blue);
		}

		.table-container th.sort-desc::after {
			content: '‚Üì';
			color: var(--primary-blue);
		}

		.table-container tr:hover {
			background: var(--gray-50);
		}

		.table-container td {
			color: var(--gray-700);
			font-weight: 500;
		}

		/* Table filter controls */
		.table-filters {
			display: flex;
			gap: 12px;
			margin-bottom: 16px;
			align-items: center;
			flex-wrap: wrap;
		}

		.table-search {
			flex: 1;
			min-width: 200px;
			max-width: 300px;
		}

		.table-search input {
			width: 100%;
			padding: 8px 12px;
			border: 1px solid var(--gray-200);
			border-radius: 6px;
			font-size: var(--font-size-sm);
		}

		.table-actions {
			display: flex;
			gap: 8px;
		}

		.table-btn {
			padding: 6px 12px;
			border: 1px solid var(--gray-200);
			background: white;
			border-radius: 6px;
			font-size: var(--font-size-xs);
			cursor: pointer;
			transition: all 0.2s ease;
		}

		.table-btn:hover {
			background: var(--gray-50);
			border-color: var(--gray-300);
		}

		.table-btn.active {
			background: var(--primary-blue);
			color: white;
			border-color: var(--primary-blue);
		}

		.ai-analysis-box {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 24px;
			padding: 40px;
			border: 1px solid rgba(255, 255, 255, 0.2);
			box-shadow: var(--subtle-shadow);
			min-height: 200px;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
			overflow: hidden;
		}

		.ai-analysis-box::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 1px;
			background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
		}

		.spinner {
			border: 3px solid rgba(102, 126, 234, 0.1);
			width: 50px;
			height: 50px;
			border-radius: 50%;
			border-left-color: #667eea;
			border-top-color: #764ba2;
			animation: spin 1.2s cubic-bezier(0.4, 0, 0.2, 1) infinite;
			position: relative;
		}

		.spinner::after {
			content: '';
			position: absolute;
			top: 50%;
			left: 50%;
			width: 20px;
			height: 20px;
			border-radius: 50%;
			background: var(--primary-gradient);
			transform: translate(-50%, -50%);
			opacity: 0.3;
		}

		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}

		.floating-particles {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: -1;
		}

		.particle {
			position: absolute;
			background: rgba(255, 255, 255, 0.1);
			border-radius: 50%;
			animation: float 6s ease-in-out infinite;
		}

		@keyframes float {

			0%,
			100% {
				transform: translateY(0px) rotate(0deg);
			}

			50% {
				transform: translateY(-20px) rotate(180deg);
			}
		}

		.enterprise-header {
			background: rgba(255, 255, 255, 0.08);
			backdrop-filter: blur(30px);
			border-bottom: 1px solid var(--glass-border);
			padding: 24px 0;
			margin-bottom: 40px;
		}

		.header-content {
			max-width: 1400px;
			margin: 0 auto;
			padding: 0 24px;
			display: flex;
			justify-content: space-between;
			align-items: flex-start;
		}

		.header-left {
			flex: 1;
		}

		.breadcrumb {
			display: flex;
			align-items: center;
			gap: 8px;
			margin-bottom: 16px;
			font-size: var(--font-size-sm);
			color: var(--gray-300);
		}

		.breadcrumb-item {
			color: var(--gray-400);
			transition: color 0.2s ease;
		}

		.breadcrumb-item.active {
			color: var(--primary-blue);
			font-weight: 600;
		}

		.breadcrumb-separator {
			color: var(--gray-400);
		}

		.header-actions {
			display: flex;
			gap: 12px;
		}

		.header-btn {
			display: flex;
			align-items: center;
			gap: 8px;
			padding: 8px 16px;
			background: rgba(255, 255, 255, 0.1);
			border: 1px solid var(--glass-border);
			border-radius: 8px;
			color: white;
			font-size: var(--font-size-sm);
			font-weight: 500;
			cursor: pointer;
			transition: all 0.2s ease;
			backdrop-filter: blur(10px);
		}

		.header-btn:hover {
			background: rgba(255, 255, 255, 0.2);
			border-color: rgba(255, 255, 255, 0.3);
			transform: translateY(-1px);
		}

		.header-btn svg {
			width: 16px;
			height: 16px;
		}

		/* Toast Notifications */
		.toast-container {
			position: fixed;
			top: 24px;
			right: 24px;
			z-index: 9999;
			display: flex;
			flex-direction: column;
			gap: 12px;
		}

		.toast {
			background: white;
			border-radius: 8px;
			padding: 16px 20px;
			box-shadow: var(--deep-shadow);
			border-left: 4px solid var(--primary-blue);
			min-width: 300px;
			max-width: 400px;
			transform: translateX(100%);
			opacity: 0;
			animation: slideIn 0.3s ease forwards;
			display: flex;
			align-items: flex-start;
			gap: 12px;
		}

		.toast.success {
			border-left-color: var(--accent-green);
		}

		.toast.warning {
			border-left-color: var(--accent-yellow);
		}

		.toast.error {
			border-left-color: var(--accent-red);
		}

		.toast-icon {
			flex-shrink: 0;
			width: 20px;
			height: 20px;
		}

		.toast-content {
			flex: 1;
		}

		.toast-title {
			font-weight: 600;
			font-size: var(--font-size-sm);
			color: var(--gray-900);
			margin-bottom: 4px;
		}

		.toast-message {
			font-size: var(--font-size-sm);
			color: var(--gray-600);
			line-height: 1.4;
		}

		.toast-close {
			background: none;
			border: none;
			color: var(--gray-400);
			cursor: pointer;
			padding: 4px;
			border-radius: 4px;
			transition: color 0.2s ease;
		}

		.toast-close:hover {
			color: var(--gray-600);
		}

		@keyframes slideIn {
			to {
				transform: translateX(0);
				opacity: 1;
			}
		}

		@keyframes slideOut {
			to {
				transform: translateX(100%);
				opacity: 0;
			}
		}

		/* Advanced Charts Section */
		.charts-section {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
			gap: 24px;
			margin-bottom: 32px;
		}

		.chart-container {
			background: rgba(255, 255, 255, 0.95);
			backdrop-filter: blur(20px);
			border-radius: 16px;
			padding: 24px;
			border: 1px solid var(--glass-border);
			box-shadow: var(--medium-shadow);
			transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
		}

		.chart-container:hover {
			box-shadow: var(--deep-shadow);
			transform: translateY(-2px);
		}

		.chart-title {
			font-size: var(--font-size-lg);
			font-weight: 600;
			color: var(--gray-900);
			margin-bottom: 16px;
			text-align: center;
		}

		.chart-content {
			position: relative;
			height: 200px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.chart-content canvas {
			max-width: 100%;
			height: auto;
			border-radius: 8px;
		}

		/* Responsive chart adjustments */
		@media (max-width: 768px) {
			.charts-section {
				grid-template-columns: 1fr;
			}

			.chart-content {
				height: 150px;
			}
		}

		.hero-section {
			text-align: center;
			padding: 80px 20px;
			background: rgba(255, 255, 255, 0.08);
			backdrop-filter: blur(30px);
			border-radius: 0 0 40px 40px;
			margin-bottom: 50px;
			border: 1px solid rgba(255, 255, 255, 0.1);
			position: relative;
			overflow: hidden;
		}

		.hero-section::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 1px;
			background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
		}

		.hero-title {
			font-size: 4rem;
			font-weight: 900;
			margin-bottom: 20px;
			background: linear-gradient(135deg, #ffffff 0%, #f0f4ff 100%);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
			letter-spacing: -0.02em;
			line-height: 1.1;
		}

		.hero-subtitle {
			font-size: 1.375rem;
			color: rgba(255, 255, 255, 0.95);
			margin-bottom: 32px;
			letter-spacing: 0.01em;
			max-width: 600px;
			margin-left: auto;
			margin-right: auto;
		}

		.main-container {
			max-width: 1400px;
			margin: 0 auto;
			padding: 0 20px;
		}

		.grid-layout {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 30px;
			margin-bottom: 40px;
		}

		@media (max-width: 1024px) {
			.grid-layout {
				grid-template-columns: 1fr;
			}
		}

		.section-title {
			font-size: 2.5rem;
			font-weight: 800;
			margin-bottom: 32px;
			color: white;
			text-align: center;
			letter-spacing: -0.01em;
			position: relative;
			display: inline-block;
			left: 50%;
			transform: translateX(-50%);
		}

		.section-title::after {
			content: '';
			position: absolute;
			bottom: -8px;
			left: 50%;
			transform: translateX(-50%);
			width: 60px;
			height: 3px;
			background: var(--primary-gradient);
			border-radius: 2px;
		}

		.profit {
			color: #10b981;
			font-weight: 700;
		}

		.loss {
			color: #ef4444;
			font-weight: 700;
		}

		.message-box {
			position: fixed;
			top: 20px;
			right: 20px;
			padding: 16px 24px;
			border-radius: 12px;
			color: white;
			font-weight: 600;
			z-index: 1000;
			animation: slideIn 0.3s ease;
		}

		@keyframes slideIn {
			from {
				transform: translateX(100%);
				opacity: 0;
			}

			to {
				transform: translateX(0);
				opacity: 1;
			}
		}

		.message-success {
			background: var(--success-gradient);
		}

		.message-error {
			background: var(--danger-gradient);
		}

		.message-info {
			background: var(--primary-gradient);
		}
	</style>
</head>

<body>
	<!-- Toast Notifications -->
	<div id="toastContainer" class="toast-container"></div>

	<!-- Floating Particles Background -->
	<div class="floating-particles" id="particles"></div>

	<!-- Enterprise Header -->
	<header class="enterprise-header">
		<div class="header-content">
			<div class="header-left">
				<div class="breadcrumb">
					<span class="breadcrumb-item">Real Estate</span>
					<span class="breadcrumb-separator">/</span>
					<span class="breadcrumb-item">Investment Analysis Dashboard</span>
				</div>
				<h1 class="hero-title">Interactive Investment Dashboard</h1>
			</div>
			<div class="header-right">
				<div class="header-actions">
					<button class="header-btn" id="exportBtn">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
							stroke-width="2">
							<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
							<polyline points="7,10 12,15 17,10" />
							<line x1="12" y1="15" x2="12" y2="3" />
						</svg>
						Export
					</button>
					<button class="header-btn" id="shareBtn">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
							stroke-width="2">
							<circle cx="18" cy="5" r="3" />
							<circle cx="6" cy="12" r="3" />
							<circle cx="18" cy="19" r="3" />
							<line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
							<line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
						</svg>
						Share
					</button>
				</div>
			</div>
		</div>
	</header>

	<div class="main-container">
		<!-- Configuration Section -->
		<div class="config-section">
			<!-- Left Column -->
			<div class="space-y-6">
				<!-- Property Details -->
				<div class="accordion active">
					<div class="accordion-header">
						<span>üè† Property Details</span>
						<svg class="accordion-icon" width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
							<path fill-rule="evenodd"
								d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
								clip-rule="evenodd" />
						</svg>
					</div>
					<div class="accordion-content">
						<div class="space-y-4">
							<div>
								<label class="block text-sm font-semibold mb-3 text-gray-700">Purchase Price
									($)</label>
								<input type="number" id="purchasePrice" class="input-field" value="740000" min="100000"
									step="10000">
							</div>
							<div>
								<label class="block text-sm font-semibold mb-2 text-gray-700">Pre-build Down Payment
									($)</label>
								<input type="number" id="prebuildDownPayment" class="input-field" value="148000" min="0"
									step="1000">
							</div>
							<div>
								<label class="block text-sm font-semibold mb-2 text-gray-700">Additional Deposit</label>
								<div class="radio-group">
									<label class="radio-option selected">
										<input type="radio" name="additionalDeposit" value="0" checked>
										<span>0%</span>
									</label>
									<label class="radio-option">
										<input type="radio" name="additionalDeposit" value="0.05">
										<span>5%</span>
									</label>
									<label class="radio-option">
										<input type="radio" name="additionalDeposit" value="0.10">
										<span>10%</span>
									</label>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Financial & Cost Details -->
				<div class="accordion active">
					<div class="accordion-header">
						<span>üí≥ Financial & Cost Details</span>
						<svg class="accordion-icon" width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
							<path fill-rule="evenodd"
								d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
								clip-rule="evenodd" />
						</svg>
					</div>
					<div class="accordion-content">
						<div class="space-y-4">
							<div>
								<label class="block text-sm font-semibold mb-2 text-gray-700">Mortgage Interest
									Rate</label>
								<select id="interestRate" class="input-field">
									<option value="3.99">3.99%</option>
									<option value="4.09">4.09%</option>
									<option value="4.25">4.25%</option>
									<option value="4.5" selected>4.50%</option>
								</select>
							</div>
							<div>
								<label class="block text-sm font-semibold mb-2 text-gray-700">Annual Property Taxes
									($)</label>
								<input type="number" id="propertyTax" class="input-field" value="2950" min="0"
									step="50">
							</div>
							<div>
								<label class="block text-sm font-semibold mb-2 text-gray-700">Monthly Strata Fees
									($)</label>
								<input type="number" id="strataFees" class="input-field" value="461" min="0" step="10">
							</div>
							<div>
								<label class="block text-sm font-semibold mb-2 text-gray-700">Realtor Fees (Purchase &
									Sale, %)</label>
								<input type="number" id="realtorFees" class="input-field" value="2" min="0" max="10"
									step="0.1">
							</div>
							<div>
								<label class="block text-sm font-semibold mb-2 text-gray-700">Property Transfer Tax (%)
									<span id="pttValue" class="text-sm text-gray-600">1.75%</span></label>
								<input type="range" id="propertyTransferTax" class="range-slider" value="1.75" min="0"
									max="5" step="0.01">
							</div>
							<div>
								<label class="block text-sm font-semibold mb-2 text-gray-700">Annual Maintenance/Repair
									(% of Annual
									Gross Rent) <span id="maintenanceValue"
										class="text-sm text-gray-600">8.0%</span></label>
								<input type="range" id="maintenanceRate" class="range-slider" value="8" min="0" max="20"
									step="0.5">
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Right Column -->
			<div class="space-y-6">
				<!-- Rental Details -->
				<div class="accordion active">
					<div class="accordion-header">
						<span>üí∞ Rental Details</span>
						<svg class="accordion-icon" width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
							<path fill-rule="evenodd"
								d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
								clip-rule="evenodd" />
						</svg>
					</div>
					<div class="accordion-content">
						<div class="space-y-4">
							<div>
								<label class="block text-sm font-semibold mb-2 text-gray-700">Rental Type</label>
								<div class="radio-group">
									<label class="radio-option selected">
										<input type="radio" name="rentalType" value="longTerm" checked>
										<span>Long-Term</span>
									</label>
									<label class="radio-option">
										<input type="radio" name="rentalType" value="shortTerm">
										<span>Short-Term</span>
									</label>
								</div>
							</div>

							<div id="longTermRentalInputs">
								<div class="space-y-4">
									<div>
										<label class="block text-sm font-semibold mb-2 text-gray-700">Monthly Rental
											Income ($)</label>
										<input type="number" id="rentalIncome" class="input-field" value="3300" min="0"
											step="100">
									</div>
									<div>
										<label class="block text-sm font-semibold mb-2 text-gray-700">Annual Vacancy
											Rate (%) <span id="vacancyValue"
												class="text-sm text-gray-600">2.0%</span></label>
										<input type="range" id="vacancyRate" class="range-slider" value="2" min="0"
											max="10" step="0.1">
									</div>
								</div>
							</div>

							<div id="shortTermRentalInputs" class="hidden">
								<div class="space-y-4">
									<div>
										<label class="block text-sm font-semibold mb-2 text-gray-700">Short-Term Monthly
											Gross Income ($)</label>
										<input type="number" id="shortTermRentalIncome" class="input-field" value="6000"
											min="0" step="100">
									</div>
									<div>
										<label class="block text-sm font-semibold mb-2 text-gray-700">Short-Term
											Occupancy Rate (%)
											<span id="shortTermOccupancyValue"
												class="text-sm text-gray-600">60%</span></label>
										<input type="range" id="shortTermOccupancyRate" class="range-slider" value="60"
											min="0" max="100" step="1">
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Investment Horizon & Sale Scenario -->
				<div class="accordion active">
					<div class="accordion-header">
						<span>‚è∞ Investment Horizon & Sale Scenario</span>
						<svg class="accordion-icon" width="24" height="24" viewBox="0 0 20 20" fill="currentColor">
							<path fill-rule="evenodd"
								d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
								clip-rule="evenodd" />
						</svg>
					</div>
					<div class="accordion-content">
						<div class="space-y-4">
							<div>
								<label class="block text-sm font-semibold mb-2 text-gray-700">Length of Hold
									(Years)</label>
								<select id="holdLength" class="input-field">
									<option value="2">2 Years</option>
									<option value="5">5 Years</option>
									<option value="10">10 Years</option>
								</select>
							</div>
							<div>
								<label class="block text-sm font-semibold mb-2 text-gray-700">Payment Frequency</label>
								<div class="radio-group">
									<label class="radio-option selected">
										<input type="radio" name="paymentFrequency" value="monthly" checked>
										<span>Monthly</span>
									</label>
									<label class="radio-option">
										<input type="radio" name="paymentFrequency" value="weekly">
										<span>Weekly (Accelerated)</span>
									</label>
								</div>
							</div>
							<div>
								<label class="block text-sm font-semibold mb-2 text-gray-700">Expected Sale Price
									Change</label>
								<div class="radio-group">
									<label class="radio-option selected">
										<input type="radio" name="saleScenario" value="-0.10" checked>
										<span>10% Below Purchase</span>
									</label>
									<label class="radio-option">
										<input type="radio" name="saleScenario" value="0">
										<span>At Purchase Price</span>
									</label>
									<label class="radio-option">
										<input type="radio" name="saleScenario" value="0.10">
										<span>10% Above Purchase</span>
									</label>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Spacing after configuration -->
		<div class="mb-12"></div>

		<!-- Action Buttons -->
		<div class="text-center mb-8">
			<button id="resetBtn" class="btn-secondary">üîÑ Reset All Parameters</button>
		</div>

		<!-- Results Section -->
		<div id="results">
			<h2 class="section-title">Investment Summary</h2>

			<!-- Advanced Charts Section -->
			<div class="charts-section">
				<div class="chart-container">
					<h3 class="chart-title">Investment Breakdown</h3>
					<div class="chart-content">
						<canvas id="investmentChart" width="400" height="200"></canvas>
					</div>
				</div>
				<div class="chart-container">
					<h3 class="chart-title">Cash Flow Timeline</h3>
					<div class="chart-content">
						<canvas id="cashFlowChart" width="400" height="200"></canvas>
					</div>
				</div>
			</div>

			<!-- KPI Cards -->
			<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
				<div class="kpi-card glass-card-hover">
					<div class="text-lg font-semibold text-gray-600">Net Profit/Loss</div>
					<div id="kpiNetProfitLoss" class="kpi-value"></div>
				</div>
				<div class="kpi-card glass-card-hover">
					<div class="text-lg font-semibold text-gray-600">Total Initial Outlay</div>
					<div id="kpiInitialOutlay" class="kpi-value"></div>
				</div>
				<div class="kpi-card glass-card-hover">
					<div class="text-lg font-semibold text-gray-600">Total Net Rental Income</div>
					<div id="kpiNetRentalIncome" class="kpi-value"></div>
				</div>
			</div>

			<!-- Summary Table -->
			<div id="summaryTableContainer" class="table-container mb-8"></div>

			<!-- Charts Grid -->
			<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
				<div>
					<h3 class="text-xl font-bold text-white mb-4 text-center">Initial Capital Allocation</h3>
					<div class="chart-container">
						<canvas id="initialOutlayChart"></canvas>
					</div>
				</div>
				<div>
					<h3 class="text-xl font-bold text-white mb-4 text-center">Net Profit/Loss by Sale Scenario</h3>
					<div class="chart-container">
						<canvas id="profitLossChart"></canvas>
					</div>
				</div>
			</div>

			<!-- AI Analysis -->
			<h2 class="section-title">AI Investment Analysis</h2>
			<div class="ai-analysis-box" id="aiAnalysisBox">
				<div class="spinner hidden" id="aiSpinner"></div>
				<p id="aiAnalysisText" class="text-center text-gray-500">Loading AI analysis...</p>
			</div>

			<!-- Detailed Breakdown -->
			<h2 class="section-title mt-12">Detailed Breakdown</h2>
			<div id="breakdownTableContainer" class="table-container mb-16"></div>
		</div>
	</div>

	<script>
		'use strict';

		// Global chart instances
		let initialOutlayChartInstance;
		let profitLossChartInstance;
		let investmentChartInstance;
		let cashFlowChartInstance;

		// Advanced chart functions
		function createInvestmentChart(data) {
			const ctx = document.getElementById('investmentChart');
			if (!ctx) return;

			const canvas = ctx;
			const context = canvas.getContext('2d');
			const width = canvas.width;
			const height = canvas.height;

			// Clear canvas
			context.clearRect(0, 0, width, height);

			// Draw chart background
			context.fillStyle = '#f8fafc';
			context.fillRect(0, 0, width, height);

			// Chart data
			const chartData = data || {
				prebuildDownPayment: 148000,
				additionalDeposit: 0,
				remainingDownPayment: 222000,
				totalInvestment: 370000
			};

			// Calculate percentages based on the purchase price (not total investment)
			// This shows how the purchase price is financed
			const purchasePrice = chartData.prebuildDownPayment + chartData.additionalDeposit + chartData.remainingDownPayment;
			const prebuildPercent = (chartData.prebuildDownPayment / purchasePrice) * 100;
			const additionalPercent = (chartData.additionalDeposit / purchasePrice) * 100;
			const remainingPercent = (chartData.remainingDownPayment / purchasePrice) * 100;

			// Colors
			const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'];

			// Draw pie chart
			const centerX = width / 2;
			const centerY = height / 2 - 20; // Move chart up to make room for legend
			const radius = Math.min(width, height) * 0.25; // Smaller radius to make room

			let currentAngle = 0;
			const segments = [
				{ label: 'Pre-build Down Payment', value: prebuildPercent, color: colors[0] },
				{ label: 'Additional Deposit', value: additionalPercent, color: colors[1] },
				{ label: 'Remaining Down Payment', value: remainingPercent, color: colors[2] }
			];

			segments.forEach((segment, index) => {
				const sliceAngle = (segment.value / 100) * 2 * Math.PI;

				// Draw pie slice
				context.beginPath();
				context.moveTo(centerX, centerY);
				context.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
				context.closePath();
				context.fillStyle = segment.color;
				context.fill();

				// Draw label (only if slice is large enough)
				if (segment.value > 5) {
					const labelAngle = currentAngle + sliceAngle / 2;
					const labelX = centerX + Math.cos(labelAngle) * (radius + 20);
					const labelY = centerY + Math.sin(labelAngle) * (radius + 20);

					context.fillStyle = '#1e293b';
					context.font = '9px Inter, sans-serif';
					context.textAlign = 'center';
					context.fillText(`${segment.value.toFixed(1)}%`, labelX, labelY);
				}

				currentAngle += sliceAngle;
			});

			// Draw legend at the bottom with better spacing
			const legendY = height - 40;
			const legendSpacing = width / segments.length;

			segments.forEach((segment, index) => {
				const legendX = (legendSpacing * index) + (legendSpacing / 2) - 60; // Center each legend item

				// Legend color box
				context.fillStyle = segment.color;
				context.fillRect(legendX, legendY, 10, 10);

				// Legend text
				context.fillStyle = '#1e293b';
				context.font = '9px Inter, sans-serif';
				context.textAlign = 'left';
				context.fillText(segment.label, legendX + 15, legendY + 8);
			});
		}

		function createCashFlowChart(data) {
			const ctx = document.getElementById('cashFlowChart');
			if (!ctx) return;

			const canvas = ctx;
			const context = canvas.getContext('2d');
			const width = canvas.width;
			const height = canvas.height;

			// Clear canvas
			context.clearRect(0, 0, width, height);

			// Draw chart background
			context.fillStyle = '#f8fafc';
			context.fillRect(0, 0, width, height);

			// Chart data - simulate cash flow over time
			const months = ['Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'];
			const cashFlow = data || [-370000, -12000, -12000, -12000, 800000]; // Initial investment, annual costs, final sale

			// Find min and max for scaling
			const minValue = Math.min(...cashFlow);
			const maxValue = Math.max(...cashFlow);
			const range = maxValue - minValue;

			// Chart dimensions
			const margin = 40;
			const chartWidth = width - 2 * margin;
			const chartHeight = height - 2 * margin;

			// Draw grid lines
			context.strokeStyle = '#e2e8f0';
			context.lineWidth = 1;
			for (let i = 0; i <= 4; i++) {
				const y = margin + (i * chartHeight / 4);
				context.beginPath();
				context.moveTo(margin, y);
				context.lineTo(width - margin, y);
				context.stroke();
			}

			// Draw cash flow line
			context.strokeStyle = '#3b82f6';
			context.lineWidth = 3;
			context.beginPath();

			cashFlow.forEach((value, index) => {
				const x = margin + (index * chartWidth / (cashFlow.length - 1));
				const y = margin + chartHeight - ((value - minValue) / range * chartHeight);

				if (index === 0) {
					context.moveTo(x, y);
				} else {
					context.lineTo(x, y);
				}

				// Draw data points
				context.fillStyle = '#3b82f6';
				context.beginPath();
				context.arc(x, y, 4, 0, 2 * Math.PI);
				context.fill();
			});

			context.stroke();

			// Draw labels
			context.fillStyle = '#64748b';
			context.font = '10px Inter, sans-serif';
			context.textAlign = 'center';

			// X-axis labels
			months.forEach((month, index) => {
				const x = margin + (index * chartWidth / (months.length - 1));
				context.fillText(month, x, height - 10);
			});

			// Y-axis labels
			for (let i = 0; i <= 4; i++) {
				const value = minValue + (i * range / 4);
				const y = margin + (i * chartHeight / 4);
				context.textAlign = 'right';
				context.fillText(`$${(value / 1000).toFixed(0)}k`, margin - 10, y + 3);
			}

			// Chart title
			context.fillStyle = '#1e293b';
			context.font = '12px Inter, sans-serif';
			context.textAlign = 'center';
			context.fillText('5-Year Cash Flow Projection', width / 2, 20);
		}

		// Create floating particles background
		function createParticles() {
			const particlesContainer = document.getElementById('particles');
			for (let i = 0; i < 50; i++) {
				const particle = document.createElement('div');
				particle.className = 'particle';
				particle.style.left = Math.random() * 100 + '%';
				particle.style.top = Math.random() * 100 + '%';
				particle.style.width = Math.random() * 6 + 2 + 'px';
				particle.style.height = particle.style.width;
				particle.style.animationDelay = Math.random() * 6 + 's';
				particle.style.animationDuration = Math.random() * 3 + 3 + 's';
				particlesContainer.appendChild(particle);
			}
		}

		// Accordion functionality
		function initAccordions() {
			const accordions = document.querySelectorAll('.accordion');
			accordions.forEach(accordion => {
				const header = accordion.querySelector('.accordion-header');
				header.addEventListener('click', () => {
					accordion.classList.toggle('active');
				});
			});
		}

		// Radio button styling
		function initRadioButtons() {
			const radioGroups = document.querySelectorAll('.radio-group');
			radioGroups.forEach(group => {
				const options = group.querySelectorAll('.radio-option');
				options.forEach(option => {
					const radio = option.querySelector('input[type="radio"]');
					if (radio.checked) {
						option.classList.add('selected');
					}

					radio.addEventListener('change', () => {
						options.forEach(opt => opt.classList.remove('selected'));
						option.classList.add('selected');
					});
				});
			});
		}

		// Helper function to format currency
		function formatCurrency(value) {
			return new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD' }).format(value);
		}

		// Core Mortgage Amortization Calculation Function
		function calculateAmortizationDetails(principal, annualRate, paymentFrequency, holdYears) {
			let balance = principal;
			let totalInterestPaid = 0;
			let standardMonthlyPayment;
			let effectivePaymentAmount;
			let paymentsPerYear;
			let periodicRate;

			const standardAmortizationYears = 25;

			const monthlyRate = annualRate / 12 / 100;
			const totalMonthlyPayments = standardAmortizationYears * 12;

			if (monthlyRate === 0) {
				standardMonthlyPayment = principal / totalMonthlyPayments;
			} else {
				standardMonthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, totalMonthlyPayments)) / (Math.pow(1 + monthlyRate, totalMonthlyPayments) - 1);
			}

			if (paymentFrequency === 'monthly') {
				effectivePaymentAmount = standardMonthlyPayment;
				paymentsPerYear = 12;
				periodicRate = annualRate / 12 / 100;
			} else {
				effectivePaymentAmount = standardMonthlyPayment / 4;
				paymentsPerYear = 52;
				periodicRate = annualRate / paymentsPerYear / 100;
			}

			const totalPaymentsInHold = holdYears * paymentsPerYear;

			for (let i = 0; i < totalPaymentsInHold; i++) {
				if (balance <= 0) {
					balance = 0;
					break;
				}
				let interestPortion = balance * periodicRate;
				let principalPortion = effectivePaymentAmount - interestPortion;

				if (principalPortion < 0) {
					principalPortion = 0;
				}

				balance -= principalPortion;
				totalInterestPaid += interestPortion;
			}

			return {
				remainingBalance: Math.max(0, balance),
				totalInterestPaid: totalInterestPaid,
				standardMonthlyPayment: standardMonthlyPayment,
				effectivePaymentAmount: effectivePaymentAmount,
				paymentsPerYear: paymentsPerYear
			};
		}

		// Chart Functions
		function createInitialOutlayChart(data) {
			const ctx = document.getElementById('initialOutlayChart').getContext('2d');

			if (initialOutlayChartInstance) {
				initialOutlayChartInstance.destroy();
			}

			initialOutlayChartInstance = new Chart(ctx, {
				type: 'doughnut',
				data: {
					labels: ['Pre-build Down Payment', 'Additional Deposit', 'Property Transfer Tax', 'Purchase Realtor Fees'],
					datasets: [{
						data: data,
						backgroundColor: [
							'#667eea',
							'#764ba2',
							'#f093fb',
							'#f5576c'
						],
						borderWidth: 0,
						hoverOffset: 8
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: {
							position: 'bottom',
							labels: {
								font: {
									size: 14,
									weight: 'bold',
									family: 'Inter'
								},
								color: '#1f2937',
								usePointStyle: true,
								padding: 20
							}
						},
						tooltip: {
							callbacks: {
								label: function (context) {
									let label = context.label || '';
									if (label) {
										label += ': ';
									}
									if (context.parsed !== null) {
										label += formatCurrency(context.parsed);
									}
									return label;
								}
							},
							bodyFont: {
								size: 14,
								family: 'Inter'
							},
							padding: 12,
							backgroundColor: 'rgba(255, 255, 255, 0.95)',
							titleColor: '#1a202c',
							bodyColor: '#1a202c',
							borderColor: 'rgba(102, 126, 234, 0.2)',
							borderWidth: 1
						}
					}
				}
			});
		}

		function createProfitLossChart(labels, data) {
			const ctx = document.getElementById('profitLossChart').getContext('2d');

			if (profitLossChartInstance) {
				profitLossChartInstance.destroy();
			}

			profitLossChartInstance = new Chart(ctx, {
				type: 'bar',
				data: {
					labels: labels,
					datasets: [{
						label: 'Net Profit/Loss',
						data: data,
						backgroundColor: data.map(value => value >= 0 ? '#10b981' : '#ef4444'),
						borderColor: data.map(value => value >= 0 ? '#059669' : '#dc2626'),
						borderWidth: 2,
						borderRadius: 8,
						borderSkipped: false
					}]
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					plugins: {
						legend: {
							display: false,
						},
						tooltip: {
							callbacks: {
								label: function (context) {
									let label = context.dataset.label || '';
									if (label) {
										label += ': ';
									}
									if (context.parsed.y !== null) {
										label += formatCurrency(context.parsed.y);
									}
									return label;
								}
							},
							bodyFont: {
								size: 14,
								family: 'Inter'
							},
							padding: 12,
							backgroundColor: 'rgba(255, 255, 255, 0.95)',
							titleColor: '#1a202c',
							bodyColor: '#1a202c',
							borderColor: 'rgba(102, 126, 234, 0.2)',
							borderWidth: 1
						}
					},
					scales: {
						y: {
							beginAtZero: true,
							title: {
								display: true,
								text: 'Amount (CAD)',
								font: {
									size: 14,
									weight: 'bold',
									family: 'Inter'
								},
								color: '#ffffff'
							},
							ticks: {
								callback: function (value, index, values) {
									return formatCurrency(value);
								},
								font: {
									size: 12,
									family: 'Inter'
								},
								color: '#1f2937'
							},
							grid: {
								color: 'rgba(255, 255, 255, 0.1)'
							}
						},
						x: {
							grid: {
								display: false
							},
							ticks: {
								font: {
									size: 12,
									family: 'Inter'
								},
								color: '#1f2937'
							}
						}
					}
				}
			});
		}

		// Mock AI Analysis Function
		function generateMockAnalysis(data) {
			const isProfitable = data.currentNetProfitLoss > 0;
			const profitPercentage = Math.abs(data.currentNetProfitLoss / data.totalInitialCashOutlay * 100);

			let analysis = `üìä **Investment Analysis Summary**\n\n`;

			if (isProfitable) {
				analysis += `‚úÖ **POSITIVE OUTCOME**: This investment shows a profit of ${formatCurrency(data.currentNetProfitLoss)} over ${data.holdLengthYears} years.\n\n`;
				analysis += `üí∞ **Return on Investment**: ${profitPercentage.toFixed(1)}% return on your initial outlay of ${formatCurrency(data.totalInitialCashOutlay)}.\n\n`;
			} else {
				analysis += `‚ö†Ô∏è **NEGATIVE OUTCOME**: This investment shows a loss of ${formatCurrency(Math.abs(data.currentNetProfitLoss))} over ${data.holdLengthYears} years.\n\n`;
				analysis += `üìâ **Loss Percentage**: ${profitPercentage.toFixed(1)}% loss on your initial outlay of ${formatCurrency(data.totalInitialCashOutlay)}.\n\n`;
			}

			analysis += `üè† **Key Factors**:\n`;
			analysis += `‚Ä¢ Purchase Price: ${formatCurrency(data.purchasePrice)}\n`;
			analysis += `‚Ä¢ Mortgage Amount: ${formatCurrency(data.mortgageAmount)} at ${data.interestRate}%\n`;
			analysis += `‚Ä¢ Rental Income: ${formatCurrency(data.rentalIncomePerMonth)}/month (${data.rentalType === 'longTerm' ? 'Long-term' : 'Short-term'})\n`;
			analysis += `‚Ä¢ Sale Scenario: ${data.currentSaleScenarioLabel}\n\n`;

			if (isProfitable) {
				analysis += `üéØ **Recommendation**: This appears to be a viable investment with positive cash flow and potential for appreciation. Consider market conditions and your risk tolerance.`;
			} else {
				analysis += `üéØ **Recommendation**: This investment currently shows negative returns. Consider negotiating a lower purchase price, increasing rental income, or exploring different market conditions.`;
			}

			return analysis;
		}

		// AI Analysis Function
		async function getAiAnalysis(data) {
			const aiAnalysisBox = document.getElementById('aiAnalysisBox');
			const aiSpinner = document.getElementById('aiSpinner');
			const aiAnalysisText = document.getElementById('aiAnalysisText');

			if (!aiAnalysisBox || !aiSpinner || !aiAnalysisText) {
				console.error('AI analysis elements not found');
				return;
			}

			aiAnalysisText.textContent = '';
			aiAnalysisText.classList.add('hidden');
			aiSpinner.classList.remove('hidden');
			aiAnalysisBox.classList.add('justify-center', 'items-center');

			const prompt = `Analyze the following investment scenario and provide a concise summary of its potential profitability, key risks, and benefits. Focus on the financial outcome, especially the Net Profit/Loss.

            Investment Data:
            - Purchase Price: ${formatCurrency(data.purchasePrice)}
            - Initial Outlay: ${formatCurrency(data.totalInitialCashOutlay)}
            - Mortgage Amount: ${formatCurrency(data.mortgageAmount)}
            - Interest Rate: ${data.interestRate}%
            - Holding Period: ${data.holdLengthYears} years
            - Rental Type: ${data.rentalType}
            - Monthly Gross Rental Income: ${formatCurrency(data.rentalIncomePerMonth)}
            - Vacancy/Occupancy Rate: ${data.rentalType === 'longTerm' ? (data.actualVacancyRate * 100).toFixed(1) + '% Vacancy' : ((1 - data.actualVacancyRate) * 100).toFixed(0) + '% Occupancy'}
            - Total Net Rental Income over hold period: ${formatCurrency(data.totalNetRentalIncome)}
            - Total Interest Paid over hold period: ${formatCurrency(data.totalInterestPaid)}
            - Current Sale Scenario: ${data.currentSaleScenarioLabel}
            - Estimated Sale Price: ${formatCurrency(data.currentSalePrice)}
            - Net Profit/Loss: ${formatCurrency(data.currentNetProfitLoss)}

            Based on these figures, provide a summary.`;

			// Always use mock AI analysis
			const mockAnalysis = generateMockAnalysis(data);
			aiAnalysisText.innerHTML = mockAnalysis.replace(/\n/g, '<br>');
			aiAnalysisText.classList.remove('hidden');
			aiAnalysisBox.classList.remove('justify-center', 'items-center');
			aiSpinner.classList.add('hidden');
		}

		// Main Calculation and Display Function
		function calculateProfitability() {
			try {
				// Get Input Values
				const purchasePrice = parseFloat(document.getElementById('purchasePrice').value);
				const prebuildDownPayment = parseFloat(document.getElementById('prebuildDownPayment').value);
				const additionalDepositRate = parseFloat(document.querySelector('input[name="additionalDeposit"]:checked').value);
				const interestRate = parseFloat(document.getElementById('interestRate').value);
				const annualPropertyTax = parseFloat(document.getElementById('propertyTax').value);
				const monthlyStrataFees = parseFloat(document.getElementById('strataFees').value);
				const realtorFeesRate = parseFloat(document.getElementById('realtorFees').value) / 100;
				const propertyTransferTaxRate = parseFloat(document.getElementById('propertyTransferTax').value) / 100;
				const holdLengthYears = parseInt(document.getElementById('holdLength').value);
				const paymentFrequency = document.querySelector('input[name="paymentFrequency"]:checked').value;
				const maintenanceRate = parseFloat(document.getElementById('maintenanceRate').value) / 100;
				const rentalType = document.querySelector('input[name="rentalType"]:checked').value;

				let rentalIncomePerMonth;
				let actualVacancyRate;
				let currentSaleScenarioLabel;

				if (rentalType === 'longTerm') {
					rentalIncomePerMonth = parseFloat(document.getElementById('rentalIncome').value);
					actualVacancyRate = parseFloat(document.getElementById('vacancyRate').value) / 100;
				} else {
					rentalIncomePerMonth = parseFloat(document.getElementById('shortTermRentalIncome').value);
					const shortTermOccupancyRate = parseFloat(document.getElementById('shortTermOccupancyRate').value) / 100;
					actualVacancyRate = (1 - shortTermOccupancyRate);
				}

				// Basic Input Validation
				if (isNaN(purchasePrice) || isNaN(prebuildDownPayment) || isNaN(interestRate) || isNaN(rentalIncomePerMonth) ||
					isNaN(annualPropertyTax) || isNaN(monthlyStrataFees) || isNaN(realtorFeesRate) || isNaN(propertyTransferTaxRate) ||
					isNaN(holdLengthYears) || isNaN(maintenanceRate) || isNaN(actualVacancyRate) ||
					purchasePrice <= 0 || prebuildDownPayment < 0) {
					displayMessage('Please enter valid numerical values for all fields.', 'error');
					return;
				}

				// Calculate Derived Values
				const additionalDepositAmount = purchasePrice * additionalDepositRate;
				const totalDownPayment = prebuildDownPayment + additionalDepositAmount;
				const mortgageAmount = purchasePrice - totalDownPayment;

				if (mortgageAmount < 0) {
					displayMessage('Total down payment exceeds purchase price. Please adjust down payment or purchase price.', 'error');
					return;
				}

				const initialPurchaseRealtorFees = purchasePrice * realtorFeesRate;
				const propertyTransferTaxAmount = purchasePrice * propertyTransferTaxRate;
				const totalInitialCashOutlay = totalDownPayment + initialPurchaseRealtorFees + propertyTransferTaxAmount;

				const holdLengthMonths = holdLengthYears * 12;

				// Mortgage Amortization Details
				const { remainingBalance, totalInterestPaid, standardMonthlyPayment, effectivePaymentAmount } =
					calculateAmortizationDetails(mortgageAmount, interestRate, paymentFrequency, holdLengthYears);

				// Calculate Income and Expenses
				const totalGrossRentalIncome = rentalIncomePerMonth * holdLengthMonths;
				const totalVacancyLoss = totalGrossRentalIncome * actualVacancyRate;
				const totalNetRentalIncome = totalGrossRentalIncome - totalVacancyLoss;

				const totalPropertyTaxesPaid = annualPropertyTax * holdLengthYears;
				const totalStrataFeesPaid = monthlyStrataFees * holdLengthMonths;
				const totalMaintenanceCost = (rentalIncomePerMonth * 12 * maintenanceRate) * holdLengthYears;

				// Sale Scenario Calculations
				const saleScenarios = [
					{ label: '10% Below Purchase', factor: -0.10 },
					{ label: 'At Purchase Price', factor: 0 },
					{ label: '10% Above Purchase', factor: 0.10 }
				];

				const profitLossResults = [];
				const profitLossLabels = [];

				saleScenarios.forEach(scenario => {
					const salePrice = purchasePrice * (1 + scenario.factor);
					const saleRealtorFees = salePrice * realtorFeesRate;

					const totalRevenue = salePrice + totalNetRentalIncome;
					const totalCosts = totalInitialCashOutlay + totalInterestPaid + totalPropertyTaxesPaid + totalStrataFeesPaid + totalMaintenanceCost + saleRealtorFees;
					const netProfitLoss = totalRevenue - totalCosts - remainingBalance;

					profitLossResults.push(netProfitLoss);
					profitLossLabels.push(scenario.label);
				});

				// Get current sale scenario
				const currentSaleScenarioRadio = document.querySelector('input[name="saleScenario"]:checked');
				const currentSaleScenarioFactor = parseFloat(currentSaleScenarioRadio.value);
				currentSaleScenarioLabel = currentSaleScenarioRadio.parentNode.querySelector('span').textContent;

				const currentSalePrice = purchasePrice * (1 + currentSaleScenarioFactor);
				const currentSaleRealtorFees = currentSalePrice * realtorFeesRate;
				const currentTotalRevenue = currentSalePrice + totalNetRentalIncome;
				const currentTotalCosts = totalInitialCashOutlay + totalInterestPaid + totalPropertyTaxesPaid + totalStrataFeesPaid + totalMaintenanceCost + currentSaleRealtorFees;
				const currentNetProfitLoss = currentTotalRevenue - currentTotalCosts - remainingBalance;

				// Display Results
				const summaryTableContainer = document.getElementById('summaryTableContainer');
				const breakdownTableContainer = document.getElementById('breakdownTableContainer');

				// Update KPI Cards
				const netProfitLossElement = document.getElementById('kpiNetProfitLoss');
				netProfitLossElement.textContent = formatCurrency(currentNetProfitLoss);

				// Apply conditional gradient color based on value
				if (currentNetProfitLoss < 0) {
					// Negative values: red gradient
					netProfitLossElement.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
					netProfitLossElement.style.webkitBackgroundClip = 'text';
					netProfitLossElement.style.webkitTextFillColor = 'transparent';
					netProfitLossElement.style.backgroundClip = 'text';
				} else if (currentNetProfitLoss > 0) {
					// Positive values: strong green gradient
					netProfitLossElement.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
					netProfitLossElement.style.webkitBackgroundClip = 'text';
					netProfitLossElement.style.webkitTextFillColor = 'transparent';
					netProfitLossElement.style.backgroundClip = 'text';
				} else {
					// Zero values: neutral gray
					netProfitLossElement.style.background = 'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)';
					netProfitLossElement.style.webkitBackgroundClip = 'text';
					netProfitLossElement.style.webkitTextFillColor = 'transparent';
					netProfitLossElement.style.backgroundClip = 'text';
				}

				document.getElementById('kpiInitialOutlay').textContent = formatCurrency(totalInitialCashOutlay);
				document.getElementById('kpiNetRentalIncome').textContent = formatCurrency(totalNetRentalIncome);

				// Summary Table
				let summaryHtml = `
                    <table class="w-full">
                        <thead>
                            <tr>
                                <th class="py-3 px-4 text-left">Metric</th>
                                <th class="py-3 px-4 text-left">Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="font-bold bg-gray-50"><td colspan="2">Selected Scenario Inputs</td></tr>
                            <tr><td>Initial Down Payment</td><td>${formatCurrency(totalDownPayment)}</td></tr>
                            <tr><td>Mortgage Amount</td><td>${formatCurrency(mortgageAmount)}</td></tr>
                            <tr><td>Estimated Monthly Mortgage Payment (P&I)</td><td>${formatCurrency(standardMonthlyPayment)}</td></tr>
                            <tr><td>Actual Payment Frequency</td><td>${paymentFrequency.charAt(0).toUpperCase() + paymentFrequency.slice(1)} (${formatCurrency(effectivePaymentAmount)} per ${paymentFrequency === 'monthly' ? 'month' : 'week'})</td></tr>
                            <tr><td>Length of Hold</td><td>${holdLengthYears} Years</td></tr>
                            <tr><td>Rental Type</td><td>${rentalType === 'longTerm' ? 'Long-Term' : 'Short-Term'}</td></tr>
                            <tr><td>${rentalType === 'longTerm' ? 'Monthly Rental Income' : 'Short-Term Monthly Gross Income'}</td><td>${formatCurrency(rentalIncomePerMonth)}</td></tr>
                            <tr><td>${rentalType === 'longTerm' ? 'Annual Vacancy Rate' : 'Short-Term Occupancy Rate'}</td><td>${(rentalType === 'longTerm' ? actualVacancyRate : (1 - actualVacancyRate)) * 100}%</td></tr>
                            <tr><td>Current Sale Scenario</td><td>${currentSaleScenarioLabel}</td></tr>
                            <tr><td>Estimated Sale Price (Current Scenario)</td><td>${formatCurrency(currentSalePrice)}</td></tr>
                        </tbody>
                    </table>
                `;
				summaryTableContainer.innerHTML = summaryHtml;

				// Breakdown Table
				let breakdownHtml = `
                    <table class="w-full">
                        <thead>
                            <tr>
                                <th class="py-3 px-4 text-left">Category</th>
                                <th class="py-3 px-4 text-left">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="font-bold bg-gray-50"><td>Total Initial Outlay</td><td>${formatCurrency(totalInitialCashOutlay)}</td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Pre-build Down Payment</td><td>${formatCurrency(prebuildDownPayment)}</td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Additional Deposit</td><td>${formatCurrency(additionalDepositAmount)}</td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Purchase Realtor Fees (${(realtorFeesRate * 100).toFixed(1)}%)</td><td>${formatCurrency(initialPurchaseRealtorFees)}</td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Property Transfer Tax (${(propertyTransferTaxRate * 100).toFixed(2)}%)</td><td>${formatCurrency(propertyTransferTaxAmount)}</td></tr>

                            <tr class="font-bold bg-gray-50"><td>Total Rental Income (Net of Vacancy)</td><td>${formatCurrency(totalNetRentalIncome)}</td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Gross Rental Income</td><td>${formatCurrency(totalGrossRentalIncome)}</td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Vacancy Loss (${(actualVacancyRate * 100).toFixed(1)}%)</td><td>${formatCurrency(totalVacancyLoss)}</td></tr>

                            <tr class="font-bold bg-gray-50"><td>Total Operating Expenses</td><td>${formatCurrency(totalPropertyTaxesPaid + totalStrataFeesPaid + totalMaintenanceCost)}</td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Property Taxes Paid</td><td>${formatCurrency(totalPropertyTaxesPaid)}</td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Strata Fees Paid</td><td>${formatCurrency(totalStrataFeesPaid)}</td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Maintenance/Repair Costs (${(maintenanceRate * 100).toFixed(1)}% of Annual Gross Rent)</td><td>${formatCurrency(totalMaintenanceCost)}</td></tr>

                            <tr class="font-bold bg-gray-50"><td>Mortgage Related Costs & Balances</td><td></td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Total Interest Paid on Mortgage</td><td>${formatCurrency(totalInterestPaid)}</td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Remaining Mortgage Balance at Sale</td><td>${formatCurrency(remainingBalance)}</td></tr>

                            <tr class="font-bold bg-gray-50"><td>Sale Proceeds & Costs (Current Scenario)</td><td></td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Estimated Sale Price</td><td>${formatCurrency(currentSalePrice)}</td></tr>
                            <tr><td>&nbsp;&nbsp;&nbsp;&nbsp;Sale Realtor Fees (${(realtorFeesRate * 100).toFixed(1)}%)</td><td>${formatCurrency(currentSaleRealtorFees)}</td></tr>

                            <tr class="font-bold text-lg ${currentNetProfitLoss >= 0 ? 'profit' : 'loss'}">
                                <td>Net Profit/Loss After ${holdLengthYears} Years</td>
                                <td>${formatCurrency(currentNetProfitLoss)}</td>
                            </tr>
                        </tbody>
                    </table>
                `;
				breakdownTableContainer.innerHTML = breakdownHtml;

				// Update Charts
				createInitialOutlayChart([
					prebuildDownPayment,
					additionalDepositAmount,
					propertyTransferTaxAmount,
					initialPurchaseRealtorFees
				]);

				createProfitLossChart(profitLossLabels, profitLossResults);

				// Update Advanced Charts with real data
				const investmentChartData = {
					prebuildDownPayment: prebuildDownPayment,
					additionalDeposit: additionalDepositAmount,
					remainingDownPayment: mortgageAmount,
					totalInvestment: purchasePrice // Use purchase price for percentage calculations
				};
				createInvestmentChart(investmentChartData);

				// Calculate cash flow data for the timeline
				const annualOperatingCosts = (annualPropertyTax + (monthlyStrataFees * 12) + (rentalIncomePerMonth * 12 * maintenanceRate));
				const annualNetRentalIncome = (rentalIncomePerMonth * 12) * (1 - actualVacancyRate);
				const netAnnualCashFlow = annualNetRentalIncome - annualOperatingCosts - (standardMonthlyPayment * 12);

				const cashFlowData = [
					-totalInitialCashOutlay, // Year 1: Initial investment
					netAnnualCashFlow, // Year 2: Net cash flow
					netAnnualCashFlow, // Year 3: Net cash flow
					netAnnualCashFlow, // Year 4: Net cash flow
					currentSalePrice - remainingBalance + netAnnualCashFlow // Year 5: Sale proceeds + final year cash flow
				];
				createCashFlowChart(cashFlowData);

				// Trigger AI Analysis
				getAiAnalysis({
					purchasePrice,
					totalInitialCashOutlay,
					mortgageAmount,
					interestRate,
					holdLengthYears,
					rentalType,
					rentalIncomePerMonth,
					actualVacancyRate,
					totalNetRentalIncome,
					totalInterestPaid,
					currentSaleScenarioLabel,
					currentSalePrice,
					currentNetProfitLoss
				});
			} catch (error) {
				console.error('Error in calculateProfitability:', error);
				displayMessage('An error occurred while calculating. Please check your inputs and try again.', 'error');
			}
		}

		// Message Box Function
		function displayMessage(message, type = 'info') {
			const messageBox = document.createElement('div');
			messageBox.className = `message-box message-${type}`;
			messageBox.textContent = message;
			document.body.appendChild(messageBox);

			setTimeout(() => {
				messageBox.remove();
			}, 5000);
		}

		// Toggle Rental Type Inputs
		function toggleRentalInputs() {
			const rentalType = document.querySelector('input[name="rentalType"]:checked').value;
			if (rentalType === 'longTerm') {
				document.getElementById('longTermRentalInputs').classList.remove('hidden');
				document.getElementById('shortTermRentalInputs').classList.add('hidden');
			} else {
				document.getElementById('longTermRentalInputs').classList.add('hidden');
				document.getElementById('shortTermRentalInputs').classList.remove('hidden');
			}
			calculateProfitability();
		}

		// Reset Function
		function resetCalculator() {
			document.getElementById('purchasePrice').value = "740000";
			document.getElementById('prebuildDownPayment').value = "148000";
			document.querySelector('input[name="additionalDeposit"][value="0"]').checked = true;

			document.querySelector('input[name="rentalType"][value="longTerm"]').checked = true;
			document.getElementById('rentalIncome').value = "3300";
			document.getElementById('vacancyRate').value = "2";
			document.getElementById('shortTermRentalIncome').value = "6000";
			document.getElementById('shortTermOccupancyRate').value = "60";
			toggleRentalInputs();

			document.getElementById('interestRate').value = "4.5";
			document.getElementById('propertyTax').value = "2950";
			document.getElementById('strataFees').value = "461";
			document.getElementById('realtorFees').value = "2";
			document.getElementById('propertyTransferTax').value = "1.75";
			document.getElementById('holdLength').value = "2";
			document.querySelector('input[name="paymentFrequency"][value="monthly"]').checked = true;
			document.querySelector('input[name="saleScenario"][value="-0.10"]').checked = true;
			document.getElementById('maintenanceRate').value = "8";

			// Update slider displays
			document.getElementById('pttValue').textContent = `1.75%`;
			document.getElementById('maintenanceValue').textContent = `8.0%`;
			document.getElementById('vacancyValue').textContent = `2.0%`;
			document.getElementById('shortTermOccupancyValue').textContent = `60%`;

			// Update radio button styling
			initRadioButtons();

			calculateProfitability();
		}

		// Debounce utility function
		function debounce(func, wait) {
			let timeout;
			return function executedFunction(...args) {
				const later = () => {
					clearTimeout(timeout);
					func(...args);
				};
				clearTimeout(timeout);
				timeout = setTimeout(later, wait);
			};
		}

		// Toast notification system
		function showToast(type, title, message, duration = 5000) {
			const toastContainer = document.getElementById('toastContainer');
			const toast = document.createElement('div');
			toast.className = `toast ${type}`;

			const icons = {
				success: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22,4 12,14.01 9,11.01"/></svg>',
				warning: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',
				error: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>',
				info: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>'
			};

			toast.innerHTML = `
				<div class="toast-icon">${icons[type] || icons.info}</div>
				<div class="toast-content">
					<div class="toast-title">${title}</div>
					<div class="toast-message">${message}</div>
				</div>
				<button class="toast-close" onclick="this.parentElement.remove()">
					<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<line x1="18" y1="6" x2="6" y2="18"></line>
						<line x1="6" y1="6" x2="18" y2="18"></line>
					</svg>
				</button>
			`;

			toastContainer.appendChild(toast);

			setTimeout(() => {
				toast.style.animation = 'slideOut 0.3s ease forwards';
				setTimeout(() => toast.remove(), 300);
			}, duration);
		}

		// Export functionality
		function exportData() {
			const data = {
				timestamp: new Date().toISOString(),
				inputs: {
					purchasePrice: document.getElementById('purchasePrice').value,
					prebuildDownPayment: document.getElementById('prebuildDownPayment').value,
					additionalDeposit: document.querySelector('input[name="additionalDeposit"]:checked').value,
					// Add other inputs as needed
				},
				results: {
					totalInvestment: document.getElementById('totalInvestment').textContent,
					monthlyPayment: document.getElementById('monthlyPayment').textContent,
					roi: document.getElementById('roi').textContent,
					// Add other results as needed
				}
			};

			const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = `condo-investment-${new Date().toISOString().split('T')[0]}.json`;
			document.body.appendChild(a);
			a.click();
			document.body.removeChild(a);
			URL.revokeObjectURL(url);

			showToast('success', 'Export Successful', 'Your investment data has been exported successfully.');
		}

		// Share functionality
		function shareData() {
			if (navigator.share) {
				navigator.share({
					title: 'Investment Analysis',
					text: 'Check out my investment analysis!',
					url: window.location.href
				}).then(() => {
					showToast('success', 'Shared Successfully', 'Your analysis has been shared.');
				}).catch(() => {
					showToast('error', 'Share Failed', 'Unable to share at this time.');
				});
			} else {
				// Fallback: copy to clipboard
				navigator.clipboard.writeText(window.location.href).then(() => {
					showToast('success', 'Link Copied', 'Analysis link copied to clipboard.');
				}).catch(() => {
					showToast('error', 'Copy Failed', 'Unable to copy link to clipboard.');
				});
			}
		}

		// Keyboard shortcuts for power users
		function initKeyboardShortcuts() {
			document.addEventListener('keydown', (e) => {
				// Ctrl/Cmd + E: Export
				if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
					e.preventDefault();
					exportData();
				}

				// Ctrl/Cmd + S: Share
				if ((e.ctrlKey || e.metaKey) && e.key === 's') {
					e.preventDefault();
					shareData();
				}

				// Ctrl/Cmd + R: Reset
				if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
					e.preventDefault();
					document.getElementById('resetBtn').click();
				}

				// Escape: Close any open modals or focus management
				if (e.key === 'Escape') {
					// Close any open dropdowns or modals
					const activeElements = document.querySelectorAll('.active');
					activeElements.forEach(el => {
						if (el.classList.contains('dropdown') || el.classList.contains('modal')) {
							el.classList.remove('active');
						}
					});
				}
			});
		}

		// Debounced calculation function
		const debouncedCalculate = debounce(calculateProfitability, 300);

		// Event Listeners
		document.addEventListener('DOMContentLoaded', () => {
			// Initialize UI components
			createParticles();
			initAccordions();
			initRadioButtons();

			// Update slider value displays
			document.getElementById('propertyTransferTax').addEventListener('input', (event) => {
				document.getElementById('pttValue').textContent = `${parseFloat(event.target.value).toFixed(2)}%`;
			});
			document.getElementById('maintenanceRate').addEventListener('input', (event) => {
				document.getElementById('maintenanceValue').textContent = `${parseFloat(event.target.value).toFixed(1)}%`;
			});
			document.getElementById('vacancyRate').addEventListener('input', (event) => {
				document.getElementById('vacancyValue').textContent = `${parseFloat(event.target.value).toFixed(1)}%`;
			});
			document.getElementById('shortTermOccupancyRate').addEventListener('input', (event) => {
				document.getElementById('shortTermOccupancyValue').textContent = `${parseFloat(event.target.value).toFixed(0)}%`;
			});

			// Recalculate on any input change with debouncing
			const inputs = document.querySelectorAll('input, select');
			inputs.forEach(input => {
				if (input.type === 'range' || input.type === 'text' || input.type === 'number') {
					input.addEventListener('input', debouncedCalculate);
				} else {
					input.addEventListener('change', debouncedCalculate);
				}
			});

			// Header button event listeners
			document.getElementById('exportBtn').addEventListener('click', exportData);
			document.getElementById('shareBtn').addEventListener('click', shareData);

			// Initialize advanced charts with initial data
			const initialData = {
				prebuildDownPayment: 148000,
				additionalDeposit: 0,
				remainingDownPayment: 222000,
				totalInvestment: 370000
			};
			createInvestmentChart(initialData);
			createCashFlowChart();

			// Initialize keyboard shortcuts
			initKeyboardShortcuts();

			// Rental type toggle listener
			document.querySelectorAll('input[name="rentalType"]').forEach(radio => {
				radio.addEventListener('change', toggleRentalInputs);
			});

			// Reset button click
			document.getElementById('resetBtn').addEventListener('click', resetCalculator);

			// Initial setup
			toggleRentalInputs();
			calculateProfitability();
		});
	</script>
</body>

</html>
